
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard CEP</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header class="header">
    <div class="logo-siri-container">
      <img src="{{ url_for('static', filename='/img/logo_siri_no_text.png') }}" alt="Logo Siri" class="logo-siri" />
    </div>
    <h1 class="title"><span class="cep-yellow">CONTROLE ESTATÍSTICO DE PROCESSO</span></h1>
    <div class="header-right">
      <div class="last-update-label">
        <span id="lastUpdate">Última atualização:</span>
      <button class="btn btn-warning update-now-btn" id="updateNowBtn">Atualizar Agora</button>
      </div>
    </div>
  </header>
  <div class="main-content">
    <aside class="sidebar minimized" id="sidebar">
      <header class="sidebar-header">
        <div class="sidebar-buttons">
          <button id="hamburgerSidebarBtn" class="sidebar-hamburger-btn" title="Abrir/Fechar Barra Lateral" aria-label="Abrir/Fechar Barra Lateral">
            <span class="hamburger-bar"></span>
            <span class="hamburger-bar"></span>
            <span class="hamburger-bar"></span>
          </button>
        </div>
        <h3 class="sidebar-title">Filtros</h3>
      </header>
        <div class="accordion" id="filterAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingGeneral">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGeneral" aria-expanded="false" aria-controls="collapseGeneral">Defeitos Gerais</button>
            </h2>
            <div id="collapseGeneral" class="accordion-collapse collapse" aria-labelledby="headingGeneral" data-bs-parent="#filterAccordion">
              <div class="accordion-body">
                <div class="toggle-switch">
                  <span class="order-label">Todos</span>
                  <label class="switch">
                    <input type="checkbox" id="generalDefectsSwitch" checked>
                    <span class="slider"></span>
                  </label>
                  <span class="order-label">Top</span>
                </div>
                <div id="generalQuantityContainer" class="quantity-container d-flex align-items-center">
                  <label for="generalDefectsQuantity" class="me-2">Quantidade:</label>
                  <input type="number" id="generalDefectsQuantity" class="form-control quantity-input me-2" min="1" value="6">
                  <button id="generalDefectsOk" class="btn btn-warning btn-sm">OK</button>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDate">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDate" aria-expanded="false" aria-controls="collapseDate">Data</button>
            </h2>
            <div id="collapseDate" class="accordion-collapse collapse" aria-labelledby="headingDate" data-bs-parent="#filterAccordion">
              <div class="accordion-body">
                <div class="date-select-wrapper d-flex align-items-center">
                  <select id="dateFilter" class="form-select filter-select me-2">
                    <option value="today">Hoje</option>
                    <option value="yesterday">Ontem</option>
                    <option value="last3">Últimos 3 Dias</option>
                    <option value="last7">Últimos 7 Dias</option>
                    <option value="last30" selected>Últimos 30 Dias</option>
                    <option value="currentWeek">Semana Atual</option>
                    <option value="previousWeek">Semana Anterior</option>
                    <option value="currentMonth">Mês Atual</option>
                    <option value="previousMonth">Mês Anterior</option>
                    <option value="currentYear">Ano Atual</option>
                    <option value="previousYear">Ano Anterior</option>
                    <option value="custom">Personalizado</option>
                  </select>
                  <span id="updateInfoIcon" class="info-icon" data-bs-toggle="tooltip" data-bs-html="true" title="">i</span>
                </div>
                <div id="customDateRange" class="custom-date-range">
                  <input type="date" id="startDate" class="form-control date-input">
                  <input type="date" id="endDate" class="form-control date-input">
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingCells">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCells" aria-expanded="false" aria-controls="collapseCells">Células</button>
            </h2>
            <div id="collapseCells" class="accordion-collapse collapse" aria-labelledby="headingCells" data-bs-parent="#filterAccordion">
              <div class="accordion-body">
                <select id="cellFilter" class="form-select filter-select">
                  <option value="">Selecione uma célula</option>
                  <option value="UPS-01">UPS-01</option>
                  <option value="UPS-02">UPS-02</option>
                  <option value="UPS-07">UPS-07</option>
                </select>
                <button id="clearCellsBtn" class="btn btn-warning btn-sm mt-2 w-100" style="display:none;">Limpar Todos</button>
                <div id="selectedCellsSidebar" class="selected-defects-sidebar"></div>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDefect">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDefect" aria-expanded="false" aria-controls="collapseDefect">Tipo de Defeito</button>
            </h2>
            <div id="collapseDefect" class="accordion-collapse collapse" aria-labelledby="headingDefect" data-bs-parent="#filterAccordion">
              <div class="accordion-body">
                <h5 class="sidebar-section-title">Ordenar defeitos</h5>
                <div class="toggle-switch">
                  <span class="order-label">Decrescente</span>
                  <label class="switch">
                    <input type="checkbox" id="defectOrderSwitch">
                    <span class="slider"></span>
                  </label>
                  <span class="order-label">Crescente</span>
                </div>
                <div class="quantity-container d-flex align-items-center">
                  <label for="defectQuantity" class="me-2">Quantidade:</label>
                  <input type="number" id="defectQuantity" class="form-control quantity-input me-2" min="1" value="6">
                  <button id="defectQuantityOk" class="btn btn-warning btn-sm">OK</button>
                </div>
                <h5 class="sidebar-section-title">Defeitos Específicos</h5>
                <select id="defectFilter" class="form-select filter-select">
                  <option value="">Selecione um defeito</option>
                </select>
                <button id="clearDefectsBtn" class="btn btn-warning btn-sm mt-2 w-100" style="display:none;">Limpar Todos</button>
                <div id="selectedDefectsSidebar" class="selected-defects-sidebar"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="alert-history-wrapper">
          <button id="alertHistoryBtn" class="accordion-button alert-history-btn" data-bs-toggle="modal" data-bs-target="#alertHistoryModal">Histórico de Alertas</button>
        </div>
    </aside>
    <div class="snap-container">
      <!-- Página 1: Dashboard -->
      <section class="snap-page">
        <section class="charts-area no-scroll">
          <div class="charts-grid-custom">
            <div class="chart-item chart-hoje">
              <div class="defects-header">
                <button class="page-nav-btn" title="Navegar página" onclick="togglePage()">
                  <svg class="page-nav-icon" viewBox="0 0 24 24" aria-hidden="true">
                    <polyline points="6 9 12 15 18 9" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>
                <h4 class="chart-title">DEFEITOS</h4>
              </div>
              <div class="grafico-grid"></div>
            </div>
            <div class="top3-area">
              <div class="top3-title">TOP 3 DEFEITOS</div>
              <div class="top3-row">
                <div class="chart-item chart-small">
                  <h4 class="chart-title" id="topDefect1">-</h4>
                  <div class="grafico-grid"></div>
                </div>
                <div class="chart-item chart-small">
                  <h4 class="chart-title" id="topDefect2">-</h4>
                  <div class="grafico-grid"></div>
                </div>
                <div class="chart-item chart-small">
                  <h4 class="chart-title" id="topDefect3">-</h4>
                  <div class="grafico-grid"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
      <!-- Página 2: Conteúdo extra -->
      <section class="snap-page">
        <section class="charts-area no-scroll">
          <div class="charts-grid-custom single-row">
            <div class="chart-item chart-hoje">
              <div class="defects-header">
                <button class="page-nav-btn" title="Navegar página" onclick="togglePage()">
                  <svg class="page-nav-icon" viewBox="0 0 24 24" aria-hidden="true">
                    <polyline points="6 9 12 15 18 9" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>
              </div>
              <div id="selectedDefectsContainer" class="selected-defects-grid"></div>
            </div>
          </div>
        </section>
      </section>
    </div>
  </div>
  <footer class="footer">
    <img src="{{ url_for('static', filename='/img/logo_nhs_branca.png') }}" alt="Logo NHS" class="logo-nhs">
    <div id="footerCells" class="footer-cells cep-yellow"></div>
    <div class="footer-right">
      <span id="totalInspections" class="cep-yellow"></span>
      <span id="totalDefects" class="cep-yellow"></span>
      <span id="footerPeriod" class="cep-yellow"></span>
    </div>
  </footer>
  <div class="modal fade" id="alertHistoryModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Histórico de Alertas</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="alertHistoryFilters" class="accordion mb-2">
            <div class="accordion-item">
              <h2 class="accordion-header" id="alertHistoryHeadingDate">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#alertHistoryCollapseDate" aria-expanded="false" aria-controls="alertHistoryCollapseDate">Data</button>
              </h2>
              <div id="alertHistoryCollapseDate" class="accordion-collapse collapse" aria-labelledby="alertHistoryHeadingDate" data-bs-parent="#alertHistoryFilters">
                <div class="accordion-body" id="alertHistoryDateBox">
                  <select id="alertHistoryDateFilter" class="form-select form-select-sm mb-2">
                    <option value="today">Hoje</option>
                    <option value="yesterday">Ontem</option>
                    <option value="last3">Últimos 3 Dias</option>
                    <option value="last7">Últimos 7 Dias</option>
                    <option value="last30" selected>Últimos 30 Dias</option>
                    <option value="currentWeek">Semana Atual</option>
                    <option value="previousWeek">Semana Anterior</option>
                    <option value="currentMonth">Mês Atual</option>
                    <option value="previousMonth">Mês Anterior</option>
                    <option value="currentYear">Ano Atual</option>
                    <option value="previousYear">Ano Anterior</option>
                    <option value="custom">Personalizado</option>
                  </select>
                  <div id="alertHistoryCustomRange" class="gap-1 d-none">
                    <input type="date" id="alertHistoryStartDate" class="form-control form-control-sm" />
                    <input type="date" id="alertHistoryEndDate" class="form-control form-control-sm" />
                  </div>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="alertHistoryHeadingCell">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#alertHistoryCollapseCell" aria-expanded="false" aria-controls="alertHistoryCollapseCell">Células</button>
              </h2>
              <div id="alertHistoryCollapseCell" class="accordion-collapse collapse" aria-labelledby="alertHistoryHeadingCell" data-bs-parent="#alertHistoryFilters">
                <div class="accordion-body" id="alertHistoryCellBox">
                  <select id="alertHistoryCellSelect" class="form-select form-select-sm">
                    <option value="">Selecione uma célula</option>
                  </select>
                  <button id="alertHistoryClearCellsBtn" class="btn btn-warning btn-sm mt-2 w-100" style="display:none;">Limpar Todos</button>
                  <div id="alertHistorySelectedCells" class="selected-defects-sidebar"></div>
                </div>
              </div>
            </div>
          </div>
          <div id="alertHistoryList"></div>
        </div>
      </div>
    </div>
  </div>
    <script>
      let onTopPage = true;
      function updatePageNavIcon(isTop) {
        document.querySelectorAll('.page-nav-icon').forEach(icon => {
          icon.classList.toggle('up', !isTop);
        });
      }
      function togglePage() {
        const container = document.querySelector('.snap-container');
        if (onTopPage) {
          container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
          updatePageNavIcon(false);
        } else {
          container.scrollTo({ top: 0, behavior: 'smooth' });
          updatePageNavIcon(true);
        }
        onTopPage = !onTopPage;
      }
      updatePageNavIcon(true);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
  </body>
  </html>
